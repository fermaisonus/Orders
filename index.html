<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>fermaison bread order form</title>
<style>
*,
*::before,
*::after {
    box-sizing: border-box;
}

body {
    font-family: 'Courier New', monospace;
    margin: 0;
    padding: 0;
    background: #fff;
    color: #000;
}
main {
    max-width: 900px;
    margin: 40px auto;
}
.card {
    border: 1px solid #000;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 30px;
    box-shadow: 2px 2px 5px rgba(0,0,0,0.05);
}
.card h2 {
    text-align: center;
    font-size: 2em;
    font-weight: bold;
    margin-top: 0;
    margin-bottom: 15px;
    text-transform: lowercase;
}
.logo {
    display: block;
    margin: 0 auto 40px auto;
    max-width: 360px;   /* doubled */
    width: 100%;
    height: auto;
}
.description {
    text-align: center;
    margin-bottom: 20px;
    font-size: 1em;
}
label {
    display: block;
    margin-top: 15px;
    font-weight: bold;
    text-transform: lowercase;
}
input[type="text"], input[type="email"], input[type="tel"], select, textarea, input[type="number"] {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
    border: 1px solid #000;
    border-radius: 5px;
    font-family: 'Courier New', monospace;
    font-size: 1em;
}
textarea { resize: vertical; }
.menu-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 10px;
}
.menu-item input[type="number"] {
    width: 60px;
    margin-left: 10px;
}
button {
    display: block;
    width: 100%;
    padding: 15px;
    font-size: 1.2em;
    margin-top: 20px;
    cursor: pointer;
    border: 1px solid #000;
    border-radius: 5px;
    background: #fff;
    color: #000;
    font-family: 'Courier New', monospace;
    font-weight: bold;
    text-transform: lowercase;
}
button:active {
    background: #000;
    color: #fff;
}
.radio-group {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-top: 15px;
}
.radio-group label {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px 15px;
    border: 1px solid #000;
    border-radius: 6px;
    cursor: pointer;
    font-weight: normal;
    text-transform: lowercase;
}

.radio-group input[type="radio"] {
    accent-color: #000;
}

.total {
    font-weight: bold;
    font-size: 1.3em;
    margin-top: 20px;
    text-align: right;
    text-transform: lowercase;
}
@media (max-width: 600px) {
    main {
        padding: 0 15px;
    }
}

.payment-card {
    max-width: 600px;
    margin: 40px auto;
    padding: 25px;
    border: 1px solid #000;
    border-radius: 12px;
    box-shadow: 2px 2px 10px rgba(0,0,0,0.05);
    text-align: center;
    font-family: 'Courier New', monospace;
}

.payment-card h2 {
    font-size: 1.8em;
    margin-bottom: 15px;
    text-transform: lowercase;
}

.payment-card p {
    margin: 10px 0;
    font-size: 1em;
}

.payment-card ul {
    list-style: none;
    padding: 0;
    margin: 15px 0;
}

.payment-card ul li {
    margin: 8px 0;
    font-weight: bold;
}

.payment-card strong {
    font-weight: bold;
}

/* fade + slide-in animation for payment card */
.payment-card {
    opacity: 0;
    transform: translateY(30px);
    animation: fadeSlideIn 0.5s forwards;
}

@keyframes fadeSlideIn {
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.copy-btn {
    display: inline-block;
    margin-left: 10px;
    padding: 4px 8px;
    font-size: 0.85em;
    border: 1px solid #000;
    border-radius: 5px;
    background: #fff;
    color: #000;
    cursor: pointer;
    font-family: 'Courier New', monospace;
}

.copy-btn:active {
    background: #000;
    color: #fff;
}

</style>
</head>
<body>
<main>
<form id="breadForm">

<!-- header card -->
<div>
<img src="logo.png" alt="logo" class="logo">
<div class="description">
<p>hyperlocal, simple.</p>
<p>MIA</p>
</div>
</div>

<!-- menu card -->
<div class="card">
<h2>menu</h2>
<div id="menuContainer">loading menu...</div>
<p class="total">total: $<span id="total">0</span></p>
</div>


<!-- customer info card -->
<div class="card">
<h2>customer info</h2>
<label for="name">full name</label>
<input type="text" id="name" required>

<label for="email">email</label>
<input type="email" id="email" required pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$" title="please enter a valid email in lowercase">

<label for="phone">phone</label>
<input type="tel" id="phone" required pattern="^\d{10}$" inputmode="numeric" title="please enter a 10-digit phone number (numbers only)">
</div>

<!-- pickup info card -->
<div class="card">
<h2>pickup info</h2>
<label for="pickup">choose pickup time</label>
<select id="pickup" required>
<option value="">select a time</option>
<option>thursday 11am - 2pm</option>
<option>friday 11am - 2pm</option>
<option>sunday 9am - 2pm</option>
</select>
<p>pickup location will be sent with your order confirmation the day before pickup. </p>
</div>

<!-- payment card -->
<div class="card">
<h2>payment methods</h2>
<p>please select your payment method:</p>
<div class="radio-group">
<label><input type="radio" name="payment" value="apple pay" required> apple pay</label>
<label><input type="radio" name="payment" value="cash app"> cash app</label>
<label><input type="radio" name="payment" value="venmo"> venmo</label>
<label><input type="radio" name="payment" value="zelle"> zelle</label>
</div>
</div>

<!-- additional info card -->
<div class="card">
<h2>additional info</h2>
<label for="allergies or dietary restrictions">allergies or dietary restrictions</label>
    <p>please let us know if you have any allergies or dietary retrictions.</p>
<textarea id="allergies" rows="2"></textarea>
<label for="requests">special requests</label>
    <p>we will do our best to accommodate on a case by case basis.</p>
<textarea id="requests" rows="2"></textarea>
<label>would you like to receive our newsletter with updates and special offers?</label>
<div class="radio-group">
<label><input type="radio" name="newsletter" value="yes" required> yes</label>
<label><input type="radio" name="newsletter" value="no"> no</label>
</div>
<label>would you like to learn more about supper club?</label>
    <p>private table dinners bringing people together through shared moments, resources, and experiences. participation is application-based with a bartering cost structure based on your offerings to the community.</p>
<div class="radio-group">
<label><input type="radio" name="supperclub" value="yes" required> yes</label>
<label><input type="radio" name="supperclub" value="no"> no</label>
</div>
</div>

<!-- socials card -->
<div class="card">
<h2>socials</h2>
<p style="text-align:center;"> <b>bakery</b>  @fermaison.us || <b>supper club</b>  @entrenos.fl</p>
</div>

<!-- feedback card -->
<div class="card">
<h2>feedback</h2>
<p>leave your rating & feedback</p>
<textarea id="feedback" rows="3"></textarea>
</div>

<button type="submit">submit order</button>
</form>
</main>

<script>


// your Google Apps Script web app URL
const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxAhByd30dfj83zNLLl-KBvHNuYn4ksaVCzWMBHsf6gTnV5Aaf86yP6IJyhUg4YSm3v/exec';

// DOM elements
const menuContainer = document.getElementById('menuContainer');
const totalEl = document.getElementById('total');
let menuQtys = [];
let menuItemsNames = [];

// calculate total
function calculateTotal() {
    let total = 0;
    menuQtys.forEach(q => {
        const qty = parseInt(q.value) || 0;
        total += qty * parseFloat(q.dataset.price);
    });
    totalEl.textContent = total.toFixed(2);
}

// load menu from Google Apps Script
async function loadMenu() {
    console.log('Attempting to load menu...');
    try {
        const res = await fetch(WEB_APP_URL);
        console.log('Fetch response:', res);

        if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);

        const menu = await res.json();
        console.log('Parsed menu JSON:', menu);

        if (!Array.isArray(menu)) throw new Error('Menu is not an array');

        menuContainer.innerHTML = '';

        menu.forEach((item, i) => {
            const div = document.createElement('div');
            div.classList.add('menu-item');
            div.innerHTML = `
                <label>${item.name.toLowerCase()} ($${item.price})</label>
                <input type="number" class="menu-qty" data-price="${item.price}" value="0" min="0">
            `;
            menuContainer.appendChild(div);
        });

        menuQtys = document.querySelectorAll('.menu-qty');
        menuItemsNames = Array.from(menuQtys).map((q, i) => menu[i].name.toLowerCase());
        menuQtys.forEach(q => q.addEventListener('input', calculateTotal));

    } catch (err) {
        console.error('Menu load failed:', err);
        menuContainer.textContent = 'Menu could not load. See console for details.';
    }
}


// auto-clean phone input (10 digits only)
const phoneInput = document.getElementById('phone');
phoneInput.addEventListener('input', function () {
    this.value = this.value.replace(/\D/g, '').slice(0, 10);
});

// form submission
document.getElementById('breadForm').addEventListener('submit', async e => {
    e.preventDefault();
    const form = e.target;

    // trigger built-in validation
    if (!form.checkValidity()) {
        form.reportValidity();
        return;
    }

    const email = document.getElementById('email');
    const phone = document.getElementById('phone');

    if(!email.checkValidity()){
        alert(email.title);
        email.focus();
        return;
    }

    if(!phone.checkValidity()){
        alert(phone.title);
        phone.focus();
        return;
    }

    const today = new Date();
    const month = String(today.getMonth() + 1).padStart(2,'0');
    const day = String(today.getDate()).padStart(2,'0');
    const rand = Math.floor(Math.random() * 90 + 10);
    const orderNumber = `F-${month}${day}-${rand}`;

    // gather form data
    const data = {
        name: document.getElementById('name').value,
        email: email.value,
        phone: phone.value,
        total: totalEl.textContent,
        pickup: document.getElementById('pickup').value,
        payment: document.querySelector('input[name="payment"]:checked')?.value,
        allergies: document.getElementById('allergies').value,
        requests: document.getElementById('requests').value,
        newsletter: document.querySelector('input[name="newsletter"]:checked')?.value,
        supperclub: document.querySelector('input[name="supperclub"]:checked')?.value,
        feedback: document.getElementById('feedback').value
    };

    menuQtys.forEach((q,i)=>{
        data[menuItemsNames[i]] = parseInt(q.value) || 0;
    });

    try {
        const res = await fetch(WEB_APP_URL, {
            method: 'POST',
            body: JSON.stringify(data)
        });

        const result = await res.json();

        const orderNumber = data.orderNumber;
            const mainEl = document.querySelector('main');

            const paymentHandles = {
                "apple pay": "applepay@fermaison.us",
                "cash app": "$fermaison",
                "venmo": "@fermaison",
                "zelle": "fermaison@gmail.com"
            };

            const handle = paymentHandles[data.payment] || "please follow the payment instructions";

            mainEl.innerHTML = `
            <div class="payment-card">
                <h2>complete your payment</h2>
                <p><strong>order number:</strong> <span id="orderNumber">${orderNumber}</span>
                <button class="copy-btn" data-copy="#orderNumber">copy</button></p>
                <p>send <strong>$${data.total}</strong> via <strong>${data.payment}</strong></p>
                <p>please include your order number in the payment notes/message.</p>
                <p>payment details:</p>
                <ul>
                    <li id="paymentHandle">${handle}</li>
                </ul>
                <button class="copy-btn" data-copy="#paymentHandle">copy handle</button>
                <p>your order is confirmed once payment is received.</p>
                <p>thank you ðŸ’•</p>
            </div>
            `;

            const copyButtons = document.querySelectorAll('.copy-btn');
            copyButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const target = document.querySelector(btn.dataset.copy);
                    if(target){
                        navigator.clipboard.writeText(target.textContent)
                            .then(()=> alert('copied!'))
                            .catch(()=> alert('copy failed'));
                    }
                });
            });
        } else {
            alert("error submitting order: " + result.message);
        }
    } catch(err){
        alert("error submitting order: " + err);
    }
});

// load menu when page is ready
document.addEventListener('DOMContentLoaded', loadMenu);

   
</script>
</body>
</html>
